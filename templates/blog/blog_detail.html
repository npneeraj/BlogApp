{% extends 'base.html' %}

{% block title %}{{ blog.title }}{% endblock %}

{% block content %}
<h1>{{ blog.title }}</h1>
<p>{{ blog.body }}</p>
<p><strong>Tags:</strong> 
{% for tag in blog.tags.all %}
    <a href="{% url 'search_by_tag' tag.slug %}">{{ tag.name }}</a>{% if not forloop.last %}, {% endif %}
{% endfor %}
</p>

<h3>Comments</h3>
{% for comment in blog.comments.all %}
    <div class="comment">
        <p><strong>{{ comment.user }}</strong> said: {{ comment.content }}</p>
        <button class="btn btn-primary btn-sm" data-comment-id="{{ comment.id }}" onclick="likeComment({{ comment.id }})">
            Like ({{ comment.likes.count }})
        </button>
    </div>
{% endfor %}

<h4>Add a Comment</h4>
<form method="POST" action="{% url 'add_comment' blog.pk %}">
    {% csrf_token %}
    <div class="form-group">
        <textarea name="content" class="form-control" rows="3"></textarea>
    </div>
    <button type="submit" class="btn btn-success">Submit</button>
</form>

<h4>Share This Blog</h4>
<a href="{% url 'share_blog' blog.pk %}" class="btn btn-info">Share via Email</a>

<script>
function likeComment(commentId) {
    fetch("{% url 'like_comment' 0 %}".replace("0", commentId))
    .then(response => response.json())
    .then(data => {
        document.querySelector(`button[data-comment-id="${commentId}"]`).innerText = `Like (${data.likes_count})`;
    });
}
</script>
{% endblock %}
